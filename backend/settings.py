import os
import hmac
import hashlib

# bot_app
BOT_TOKEN = os.environ["BOT_TOKEN"]

# bot_controller
WEB_APP_URL = os.environ["WEB_APP_URL"]
ADMIN_ID = 267429209
BUTTON_TEXT = {
    "ru": "–û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
    "en": "Open Mini App"
}
WELCOME_MESSAGE = {
    "ru": "üé¨ *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MovieAI!*\n\n"
          "–ü–æ–¥–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∏–ª–∏ –∂–∞–Ω—Ä—É ‚Äî —Å –ø–æ–º–æ—â—å—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.\n\n"
          "–û—Ç–ø—Ä–∞–≤—å—Ç–µ /help, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ–±–æ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö.\n\n"
          "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.\n\n",
    "en" : "üé¨ *Welcome to MovieAI!*\n\n"
           "Find a movie by description, mood, or genre ‚Äî using the app.\n\n"
           "Send /help to learn all the features.\n\n"
           "Tap the button below to get started.\n\n"
}
HELP_MESSAGE = {
    "ru": "‚ùì *–ß—Ç–æ —É–º–µ–µ—Ç MovieAI*\n\n"
          "–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤:\n"
          "‚Ä¢  –ü–æ –∂–∞–Ω—Ä—É, –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ, –≥–æ–¥—É –∏ –¥—Ä—É–≥–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º\n"
          "‚Ä¢  –ü–æ –≤–∞—à–µ–º—É –æ–ø–∏—Å–∞–Ω–∏—é ‚Äî –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —á–∞—Ç–µ\n"
          "‚Ä¢  –ü–æ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–µ–º—É—Å—è —Ñ–∏–ª—å–º—É ‚Äî –Ω–∞–π–¥—ë—Ç –ø–æ—Ö–æ–∂–∏–µ\n\n"
          "‚ù§Ô∏è –í –ø–æ–¥–±–æ—Ä–µ ‚Äî –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ñ–∏–ª—å–º—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –ª—É—á—à–∏–µ –Ω–∞—Ö–æ–¥–∫–∏.\n\n"
          "–£ –≤–∞—Å –µ—Å—Ç—å –∏–¥–µ—è, –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ? \n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –±–æ—Ç—É ‚Äî –æ–Ω –≤—Å—ë —á–∏—Ç–∞–µ—Ç!\n\n"
          "–ù–∞–∂–º–∏—Ç–µ /start, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\n\n",
    "en" : "‚ùì *What MovieAI can do*\n\n"
            "You can search for movies in a way that suits you:\n"
            "‚Ä¢ By genre, atmosphere, year, and other filters\n"
            "‚Ä¢ By your description ‚Äî in an interactive chat\n"
            "‚Ä¢ By similar movies ‚Äî find more like the ones you like\n\n"
            "‚ù§Ô∏è In matching ‚Äî add movies to your favorites so you don‚Äôt lose great finds.\n\n"
            "Have an idea, question, or suggestion?\nJust send a message ‚Äî we read everything!\n\n"
            "Tap /start to open the mini-app\n\n"
}
FEEDBACK_MASSAGE = {
    "ru": "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å! –ú—ã –≤—Å—ë —É—á—Ç—ë–º üôå",
    "en": "Thanks for the feedback! We'll take it into account üôå"
}
PAYMENT_MESSAGE = {
    "ru": lambda amount: f"üéâ –ü–ª–∞—Ç—ë–∂ –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ! –¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ {amount} –∑–≤–µ–∑–¥ ‚≠êÔ∏è",
    "en": lambda amount: f"üéâ Payment successful! You've received {amount} stars ‚≠êÔ∏è"
}

# middlewares.auth_middleware
API_KEY = os.environ["API_KEY"]
API_KEY_NAME = "X-API-Key"
INIT_DATA_HEADER_NAME = "X-Telegram-Init-Data"
TELEGRAM_INIT_DATA_SECRET = hmac.new(b"WebAppData", BOT_TOKEN.encode(), hashlib.sha256).digest()
EXCLUDED_AUTH_PATHS = {
    "/health",
    "/preview",
    "/docs",
    "/docs/oauth2-redirect",
    "/openapi.json",
    "/redoc"
}

# middlewares.db_session_middleware
EXCLUDED_DBSESSION_PATHS = {
    "/health",
    "/log-event",
    "/docs",
    "/docs/oauth2-redirect",
    "/openapi.json",
    "/redoc"
}

# middlewares.logging_middleware
EXCLUDED_LOG_PATHS = ["/health",]

# main
ALLOW_ORIGINS = [
    "https://autogenz.com",
    "https://storage.googleapis.com",
    "http://localhost:5173",
]

# clients.bq_client
TABLE_ID = "autogen-1-438415.movieAI_logs.page_views"

# clients.client_factory
KP_API_KEY = os.environ["KINOPOISK_API_KEY"]

# prompt_templates.py
PROMPT_NUM_MOVIES = 20

# clients.openai_client
MODEL_QA = "gpt-4o"
TEMPERATURE_QA = 0.9
MODEL_MOVIES = "gpt-4o-mini"
TEMPERATURE_MOVIES = 0.9
QUESTION_PREFIX_PATTERN = r'\{\s*"questions"\s*:\s*\['
MOVIES_PREFIX_PATTERN = r'\{\s*"movies"\s*:\s*\['
OVERRIDE_DATA = {
    "The Witch": "The VVitch: A New-England Folktale",
    "Train to Busan": "Busanhaeng",
    "Train to Busan 2": "Bando",
    "The Platform": "El Hoyo",
    "The Platform 2": "El Hoyo 2",
    "The Red Turtle": "La tortue rouge",
    "Nymphomaniac": "Nymphomaniac: Vol. I"
}

# clients.gc_client
BUCKET_NAME = "autogen-images"

# db_managers.base
SQL_HOST=os.environ["SQL_HOST"]
SQL_PORT=os.environ["SQL_PORT"]
SQL_DB=os.environ["SQL_DB"]
SQL_USER=os.environ["SQL_USER"]
SQL_PSWRD = os.environ["SQL_PSWRD"]
ASYNC_DATABASE_URL = f"postgresql+asyncpg://{SQL_USER}:{SQL_PSWRD}@{SQL_HOST}:{SQL_PORT}/{SQL_USER}"

# clients.rag_pipeline
INDEX_PATH = os.environ["INDEX_PATH"]
TOP_K = 10
TOP_K_SEARCH = 30
MODEL_EMBS = "text-embedding-3-small"
CLASS_NAME = "Movie"
WEAVITE_HOST_HTTP = "weaviate"
WEAVITE_PORT_HTTP = 8080
WEAVITE_HOST_GRPC = "weaviate"
WEAVITE_PORT_GRPC = 50051

ATMOSPHERE_MAPPING = {
    "–ø—Ä–æ –ª—é–±–æ–≤—å" : "–ò—Å—Ç–æ—Ä–∏—è –æ —Å–∏–ª—å–Ω—ã—Ö —á—É–≤—Å—Ç–≤–∞—Ö, —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ –º–µ–∂–¥—É –≥–µ—Ä–æ—è–º–∏. "
                   "–§–∏–ª—å–º —Å —Ç—ë–ø–ª–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π, —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏, –¥—Ä–∞–º–æ–π –∏–ª–∏ –ª—ë–≥–∫–æ–π –∫–æ–º–µ–¥–∏–µ–π, "
                   "–≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ—Ç–æ—Ä–æ–π ‚Äî –ª—é–±–æ–≤—å, —Å—Ç—Ä–∞—Å—Ç—å –∏–ª–∏ —Å—É–¥—å–±–æ–Ω–æ—Å–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞.",
    "–¥—É—à–µ–≤–Ω—ã–π –∏ —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π" : "–î–æ–±—Ä—ã–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å–º—ã, –≤—ã–∑—ã–≤–∞—é—â–∏–µ —Å–æ—á—É–≤—Å—Ç–≤–∏–µ –∏ –∑–∞—Å—Ç–∞–≤–ª—è—é—â–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –∑–∞ –≥–µ—Ä–æ–µ–≤. "
                                "–°—é–∂–µ—Ç –æ–±—ã—á–Ω–æ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ–º —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π, —Å–∏–ª–æ–π —Å–µ–º—å–∏, –¥—Ä—É–∂–±—ã –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–æ—Å—Ç–∞. "
                                "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –º—è–≥–∫–∞—è, —Ç–µ–ø–ª–∞—è, –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–ø–µ—à–Ω–æ–µ –∏ —á–µ–ª–æ–≤–µ—á–Ω–æ–µ.",
    "–¥–∏–Ω–∞–º–∏—á–Ω—ã–π –∏ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π" : "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å –±—ã—Å—Ç—Ä—ã–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º —Å–æ–±—ã—Ç–∏–π, —ç–∫—à–µ–Ω–æ–º, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏ "
                                 "–∏ —Å–∏–ª—å–Ω—ã–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º. –ß–∞—Å—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–≥–æ–Ω–∏, –æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å–ª–æ–∂–Ω—ã–µ –º–æ—Ä–∞–ª—å–Ω—ã–µ –≤—ã–±–æ—Ä—ã. "
                                 "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ —Ç—Ä–µ–≤–æ–∂–Ω–∞—è –∏ –±—É–¥–æ—Ä–∞–∂–∞—â–∞—è.",
    "–∂–∏–∑–Ω–µ—É—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π" : "–§–∏–ª—å–º, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π –Ω–∞ –Ω–∞–¥–µ–∂–¥—É, –≤–µ—Ä—É –≤ –¥–æ–±—Ä–æ, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π. "
                          "–ì–µ—Ä–æ–∏ –º–µ–Ω—è—é—Ç—Å—è –∫ –ª—É—á—à–µ–º—É, –Ω–∞—Ö–æ–¥—è—Ç —Å–∏–ª—ã –∂–∏—Ç—å, –ª—é–±–∏—Ç—å –∏ –ø—Ä–æ—â–∞—Ç—å. "
                          "–ò—Å—Ç–æ—Ä–∏—è —á–∞—Å—Ç–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏–ª–∏ –≤–∞–∂–Ω–æ–º –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–º –æ–ø—ã—Ç–µ. "
                          "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ —Å–≤–µ—Ç–ª–∞—è, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∞—è, uplifting.",
    "–º—Ä–∞—á–Ω—ã–π –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π" : "–°—é–∂–µ—Ç —Å –≥–Ω–µ—Ç—É—â–µ–π, —Ç—ë–º–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π, —á–∞—Å—Ç–æ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –¥—Ä–∞–º—ã, –Ω—É–∞—Ä–∞, —Ç—Ä–∏–ª–ª–µ—Ä–∞ –∏–ª–∏ —Ö–æ—Ä—Ä–æ—Ä–∞. "
                              "–í–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –Ω–∞—Å—ã—â–µ–Ω —Ç–µ–Ω—è–º–∏, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞–º–∏, –º–µ–¥–ª–µ–Ω–Ω—ã–º —Ç–µ–º–ø–æ–º. "
                              "–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö, –∑–∞–≥–∞–¥–æ—á–Ω—ã—Ö –∏–ª–∏ –æ–ø–∞—Å–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö.",
    "—Å—é—Ä—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π" : "–ù–µ–æ–±—ã—á–Ω—ã–π, –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π —Ñ–∏–ª—å–º, –≥–¥–µ –Ω–∞—Ä—É—à–∞—é—Ç—Å—è –∑–∞–∫–æ–Ω—ã –ª–æ–≥–∏–∫–∏ –∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. "
                        "–ò—Å—Ç–æ—Ä–∏–∏ –º–æ–≥—É—Ç –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å —Å–Ω—ã, –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∏–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –ø—Ä–∏—Ç—á–∏. "
                        "–ú–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∏–∑–º–∞, –Ω–µ–æ–±—ã—á–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª–∞, –∞–±—Å—É—Ä–¥–Ω—ã—Ö —Å—Ü–µ–Ω –∏ –¥–≤–æ–π–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤.",
    "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π" : "–ì–ª—É–±–æ–∫–∏–π —Ñ–∏–ª—å–º, –∏—Å—Å–ª–µ–¥—É—é—â–∏–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏—Ö —Å—Ç—Ä–∞—Ö–∏, –º–æ—Ç–∏–≤–∞—Ü–∏–∏, —Ç—Ä–∞–≤–º—ã. "
                        "–ß–∞—Å—Ç–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏–Ω—Ç—Ä–∏–≥–µ, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç—è—Ö –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏. "
                        "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –ø–ª–æ—Ç–Ω–∞—è, —á–∞—Å—Ç–æ —Ç—Ä–µ–≤–æ–∂–Ω–∞—è –∏–ª–∏ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–∞—è. "
                        "–ú–æ–≥—É—Ç –±—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Ç—Ä–∏–ª–ª–µ—Ä–∞, –¥—Ä–∞–º—ã –∏–ª–∏ –¥–µ—Ç–µ–∫—Ç–∏–≤–∞.",
    "–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π" : "–°–ø–æ–∫–æ–π–Ω—ã–π, –Ω–µ—Å–ø–µ—à–Ω—ã–π —Ñ–∏–ª—å–º, —Å–æ–∑–¥–∞—é—â–∏–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å–æ–∑–µ—Ä—Ü–∞–Ω–∏—è. "
                     "–ú–∞–ª–æ –¥–∏–∞–ª–æ–≥–æ–≤, –≤–∏–∑—É–∞–ª—å–Ω–æ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã, –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –∑–≤—É–∫–µ, –ø—Ä–∏—Ä–æ–¥–µ, –≤—Ä–µ–º–µ–Ω–∏. "
                     "–ò—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –∏–ª–∏ –≤–æ–≤—Å–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å. "
                     "–í–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –Ω–∞ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è, –æ—â—É—â–µ–Ω–∏–µ –∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å.",
    "–¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π" : "–ú—Ä–∞—á–Ω–∞—è –∏ —Ç—è–∂—ë–ª–∞—è –∏—Å—Ç–æ—Ä–∏—è, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â–∞—è —Ç–µ–º—ã –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞, —É—Ç—Ä–∞—Ç—ã, –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏. "
                     "–ß–∞—Å—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –æ—â—É—â–µ–Ω–∏–µ –±–µ–∑—ã—Å—Ö–æ–¥–Ω–æ—Å—Ç–∏, —Ö–æ–ª–æ–¥–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞. "
                     "–ò—Å—Ç–æ—Ä–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω–∞—è, —Ç—Ä–∞–≥–∏—á–Ω–∞—è.",
}